#!/bin/bash
set -e

NP="${1:-8}"

echo ">>> Rendering VTK for case in: $(pwd)"
echo ">>> Using NP = ${NP}"

if ! command -v foamToVTK >/dev/null 2>&1; then
  echo "WARNING: foamToVTK not found in PATH."
  echo "Make sure you have sourced your OpenFOAM bashrc."
  echo "Continuing anyway..."
fi

echo ">>> Removing old VTK directory (if any)"
rm -rf VTK 2>/dev/null || true

if ls -d processor* >/dev/null 2>&1; then
  echo ">>> Found processor* directories -> exporting VTK in parallel"
  echo ">>> mpirun -np ${NP} foamToVTK -parallel | tee log.foamToVTK"
  mpirun -np "${NP}" foamToVTK -parallel | tee log.foamToVTK
else
  echo ">>> No processor* directories found -> serial export"
  foamToVTK | tee log.foamToVTK
fi

echo ">>> Render complete. Check the VTK/ directory."

